(()=>{"use strict";function e(e,t){e.checkValidity()?function(e){e.disabled=!1}(t):function(e){e.disabled=!0}(t)}function t(){document.querySelectorAll(".popup__form").forEach((function(t){var n=t.querySelectorAll(".popup__input"),o=t.querySelector(".popup__save-btn");e(t,o),n.forEach((function(n){n.addEventListener("input",(function(){var c;e(t,o),(c=n).validity.valid?function(e){var t="error-"+e.id;document.getElementById(t).textContent=" ",e.classList.remove("popup__input_type_error")}(c):function(e,t){var n="error-"+e.id;document.getElementById(n).textContent=t,e.classList.add("popup__input_type_error")}(c,c.validationMessage)}))}))}))}var n=document.getElementById("opened-image"),o=document.querySelector("#add-card"),c=o.querySelector(".popup__exit-btn"),r=n.querySelector(".popup__exit-btn"),a=document.querySelector("#delete-card"),i=a.querySelector(".popup__exit-btn"),u=document.getElementById("name"),d=document.querySelector(".profile__title"),l=document.getElementById("job"),s=document.querySelector(".profile__subtitle"),f=document.querySelector(".profile__avatar"),p=document.querySelector(".profile__add-button"),_=o.querySelector(".popup__form"),m=document.querySelector(".profile__edit-button"),v=document.getElementById("edit-profile"),h=v.querySelector(".popup__exit-btn"),y=v.querySelector(".popup__form"),b=document.querySelector(".profile__edit-avatar-button"),g=document.querySelector("#edit-avatar"),E=g.querySelector(".popup__exit-btn"),S=g.querySelector(".popup__form"),q={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-15",headers:{authorization:"ce4a2035-6e00-46fa-a0cc-a0f23b0a5bb3","Content-Type":"application/json"}};function k(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var L=document.getElementById("place"),x=document.getElementById("link"),C=n.querySelector(".popup__image"),B=n.querySelector(".popup__title"),I=document.getElementById("link-avatar");function U(e){e.classList.add("popup_opened"),document.addEventListener("keydown",N),t()}function T(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",N)}function N(e){27===e.keyCode&&T(document.querySelector(".popup_opened"))}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&function(e){T(e)}(e)}))}));var O=document.getElementById("template-card").content.querySelector(".cards__item"),J=document.querySelector(".cards__list"),w="e5f6768b39a8d75be758ba67";function A(e){var t=O.cloneNode(!0),o=t.querySelector(".card__image"),c=t.querySelector(".card__text"),r=t.querySelector(".card__delete-button"),a=t.querySelector(".card__favorite-button"),i=t.querySelector(".card__favorite-counter");return o.src=e.link,o.alt=e.name,c.textContent=e.name,e.likes.some((function(e){return e._id===w}))&&a.classList.add("card__favorite-button_active"),a.addEventListener("click",(function(t){var n;t.target.classList.contains("card__favorite-button_active")?(n=e._id,fetch("".concat(q.baseUrl,"/cards/likes/").concat(n),{headers:q.headers,method:"DELETE",body:JSON.stringify({likes:n})}).then(k)).then((function(e){t.target.classList.remove("card__favorite-button_active"),i.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(q.baseUrl,"/cards/likes/").concat(e),{headers:q.headers,method:"PUT",body:JSON.stringify({likes:e})}).then(k)}(e._id).then((function(e){t.target.classList.add("card__favorite-button_active"),i.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),e.owner._id!==w&&r.remove(),r.addEventListener("click",(function(){var n;console.log(e._id),(n=e._id,fetch("".concat(q.baseUrl,"/cards/").concat(n),{headers:q.headers,method:"DELETE",body:JSON.stringify({card:n})}).then(k)).then((function(){t.remove()})).catch((function(e){console.log(e)}))})),i.textContent=e.likes.length,o.addEventListener("click",(function(){!function(e){C.src=e.link,C.alt=e.name,B.textContent=e.name,U(n)}(e)})),t}function D(e){J.prepend(e)}fetch("".concat(q.baseUrl,"/users/me"),{method:"GET",headers:q.headers}).then(k).then((function(e){d.textContent=e.name,s.textContent=e.about,f.src=e.avatar,T(v)})).catch((function(e){console.log(e)})),fetch("".concat(q.baseUrl,"/cards"),{headers:q.headers}).then(k).then((function(e){e.reverse().forEach((function(e){D(A(e))}))})).catch((function(e){console.log(e)})),t(),y.addEventListener("submit",(function(e){var t,n;e.preventDefault(),(t=u.value,n=l.value,fetch("".concat(q.baseUrl,"/users/me"),{headers:q.headers,method:"PATCH",body:JSON.stringify({name:t,about:n})}).then(k)).then((function(e){d.textContent=e.name,s.textContent=e.about,T(v)})).catch((function(e){console.log(e)}))})),h.addEventListener("click",(function(){return T(v)})),m.addEventListener("click",(function(){u.value=d.textContent,l.value=s.textContent,U(v)})),p.addEventListener("click",(function(){return U(o)})),c.addEventListener("click",(function(){return T(o)})),_.addEventListener("submit",(function(e){var t,n;e.preventDefault(),(t=L.value,n=x.value,fetch("".concat(q.baseUrl,"/cards"),{headers:q.headers,method:"POST",body:JSON.stringify({name:t,link:n})}).then(k)).then((function(e){D(A(e)),_.reset(),T(o)})).catch((function(e){console.log(e)}))})),r.addEventListener("click",(function(){return T(n)})),i.addEventListener("click",(function(){return T(a)})),b.addEventListener("click",(function(){return U(g)})),E.addEventListener("click",(function(){return T(g)})),S.addEventListener("submit",(function(e){var t;e.preventDefault(),console.log(f),console.log(e),(t=I.value,fetch("".concat(q.baseUrl,"/users/me/avatar"),{headers:q.headers,method:"PATCH",body:JSON.stringify({avatar:t})}).then(k)).then((function(e){f.src=e.avatar,T(g),console.log(f.src)})).catch((function(e){console.log(e)}))}))})();